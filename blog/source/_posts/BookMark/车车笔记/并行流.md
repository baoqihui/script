```
@Override
public ScheduleTaskResult updateSuspendStatus() {
    AtomicInteger initPage=new AtomicInteger(1);
    int size=500;
    List<Long> failList = new ArrayList<>();
    //更新待开始车辆
    updateWait(failList, initPage, size);
    //更新停驶中车辆
    updateStop(failList, initPage, size);
    return ScheduleTaskResult.succeed(new ArrayList<>(),failList,"返回失败用户ID集合");
}

//更新待开始车辆，查询 开始时间<=当前时间，状态变更为停驶中
private void updateWait(List<Long> failList,AtomicInteger initPage,int size) {
    Page<SuspendRecord> waitPageList = suspendRecordRepository.findAllByStatusAndStartTimeLessThanEqual(
        WAITING.getStatus(),
        DateUtil.date(),
        PageRequest.of(initPage.intValue(), size)
    );
    updateSuspendRecord(failList, waitPageList.getContent(), STOP_ING);
    while (waitPageList.hasNext()){
        waitPageList = suspendRecordRepository.findAllByStatusAndStartTimeLessThanEqual(
            WAITING.getStatus(),
            DateUtil.date(),
            PageRequest.of(initPage.incrementAndGet(), size)
        );
        updateSuspendRecord(failList, waitPageList.getContent(), STOP_ING);
    }
}

//更新停驶中车辆，查询 结束时间<当前时间，状态变更为停驶结束
private void updateStop(List<Long> failList,AtomicInteger initPage,int size) {
    Page<SuspendRecord> stopPageList = suspendRecordRepository.findAllByStatusAndEndTimeBefore(
        STOP_ING.getStatus(),
        DateUtil.date(),
        PageRequest.of(initPage.intValue(), size)
    );
    updateSuspendRecord(failList,stopPageList.getContent(),STOP_END);
    while (stopPageList.hasNext()){
        stopPageList = suspendRecordRepository.findAllByStatusAndEndTimeBefore(
            STOP_ING.getStatus(),
            DateUtil.date(),
            PageRequest.of(initPage.incrementAndGet(), size)
        );
        updateSuspendRecord(failList, stopPageList.getContent(), STOP_END);
    }
}

/**
 * 对停驶记录进行更新
 * @param failList  更新失败的用户id
 * @param content  需要更新的列表
 * @param statusEnum 更新的状态
 */
private void updateSuspendRecord(List<Long> failList, List<SuspendRecord> content, SuspendStatusEnum statusEnum) {
    ForkJoinPool pool = new ForkJoinPool(10);
    pool.submit(() -> {
        content.parallelStream().forEach(it -> {
            Long userId = it.getUserId();
            try {
                it.setStatus(statusEnum.getStatus());
                suspendRecordRepository.save(it);
            } catch (Exception e) {
                log.error("userId:{} change status fail", userId);
                failList.add(userId);
            }
        });
    });
}
```





